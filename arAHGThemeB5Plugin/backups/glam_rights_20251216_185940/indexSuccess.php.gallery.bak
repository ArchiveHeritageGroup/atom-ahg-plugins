<?php decorate_with('layout_2col'); ?>

<?php slot('sidebar'); ?>

  <!-- Digital Object / Image -->
  <div class="card mb-4">
    <div class="card-body text-center">
      <?php if ($digitalObject): ?>
        <?php 
          $fullPath = $digitalObject->path . $digitalObject->name;
          $ext = strtolower(pathinfo($digitalObject->name, PATHINFO_EXTENSION));
          $isImage = in_array($ext, ['jpg', 'jpeg', 'png', 'gif', 'webp']);
        ?>
        <?php if ($isImage): ?>
          <img src="<?php echo esc_entities($fullPath); ?>" alt="" class="img-fluid" style="max-height: 300px;">
        <?php else: ?>
          <div class="p-4">
            <i class="fas fa-file fa-5x text-muted"></i><br>
            <small class="text-muted"><?php echo esc_entities($digitalObject->name); ?></small>
          </div>
        <?php endif; ?>
      <?php else: ?>
        <i class="fas fa-palette fa-5x text-muted"></i>
      <?php endif; ?>
    </div>
  </div>

  <!-- Digital Object Details -->
  <?php if ($digitalObject && $canEdit): ?>
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-image me-2"></i><?php echo __('Digital object'); ?></h5>
      </div>
      <div class="card-body">
        <table class="table table-sm mb-3">
          <tr>
            <td class="text-muted"><?php echo __('Filename'); ?></td>
            <td><?php echo esc_entities($digitalObject->name); ?></td>
          </tr>
          <tr>
            <td class="text-muted"><?php echo __('Media type'); ?></td>
            <td><?php echo esc_entities($digitalObject->mime_type); ?></td>
          </tr>
        </table>
        
        <div class="mt-3">
          <a href="<?php echo url_for([$qubitResource->digitalObjectsRelatedByobjectId[0], 'module' => 'digitalobject', 'action' => 'edit']); ?>" class="btn btn-sm btn-outline-primary w-100 mb-2">
            <i class="fas fa-edit me-1"></i><?php echo __('Edit digital object'); ?>
          </a>
          <a href="<?php echo url_for([$qubitResource->digitalObjectsRelatedByobjectId[0], 'module' => 'digitalobject', 'action' => 'delete']); ?>" class="btn btn-sm btn-outline-danger w-100">
            <i class="fas fa-trash me-1"></i><?php echo __('Delete digital object'); ?>
          </a>
        </div>
      </div>
    </div>
  <?php endif; ?>

  <!-- Quick Info -->
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0"><?php echo __('Quick Info'); ?></h5>
    </div>
    <ul class="list-group list-group-flush">
      <?php if ($resource->identifier): ?>
        <li class="list-group-item d-flex justify-content-between">
          <span class="text-muted"><?php echo __('Object #'); ?></span>
          <strong><?php echo esc_entities($resource->identifier); ?></strong>
        </li>
      <?php endif; ?>
      <?php if (!empty(($galleryData['work_type_name'] ?? $galleryData['work_type']))): ?>
        <li class="list-group-item d-flex justify-content-between">
          <span class="text-muted"><?php echo __('Type'); ?></span>
          <span class="badge bg-secondary"><?php echo esc_entities(($galleryData['work_type_name'] ?? $galleryData['work_type'])); ?></span>
        </li>
      <?php endif; ?>
      <?php if ($repositoryName): ?>
        <li class="list-group-item d-flex justify-content-between">
          <span class="text-muted"><?php echo __('Repository'); ?></span>
          <span><?php echo esc_entities($repositoryName); ?></span>
        </li>
      <?php endif; ?>
    </ul>
  </div>


  <!-- Collections Management -->
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0"><?php echo __('Collections Management'); ?></h5>
    </div>
    <ul class="list-group list-group-flush">
      <li class="list-group-item"><a href="<?php echo url_for(['module' => 'cco', 'action' => 'provenance', 'slug' => $resource->slug]); ?>"><i class="fas fa-sitemap me-2"></i><?php echo __('Provenance'); ?></a></li>
      <li class="list-group-item"><a href="<?php echo url_for(['module' => 'arCondition', 'action' => 'conditionCheck', 'slug' => $resource->slug]); ?>"><i class="fas fa-clipboard-check me-2"></i><?php echo __('Condition assessment'); ?></a></li>
      <li class="list-group-item"><a href="<?php echo url_for(['module' => 'spectrum', 'action' => 'index', 'slug' => $resource->slug]); ?>"><i class="fas fa-layer-group me-2"></i><?php echo __('Spectrum data'); ?></a></li>
      <li class="list-group-item"><a href="<?php echo url_for(['module' => 'grap', 'action' => 'index', 'slug' => $resource->slug]); ?>"><i class="fas fa-file-invoice-dollar me-2"></i><?php echo __('GRAP data'); ?></a></li>
      <li class="list-group-item"><a href="<?php echo url_for(['module' => 'oais', 'action' => 'createSip', 'slug' => $resource->slug]); ?>"><i class="fas fa-archive me-2"></i><?php echo __('Digital Preservation (OAIS)'); ?></a></li>
      <li class="list-group-item"><a href="<?php echo url_for(['module' => 'research', 'action' => 'cite', 'slug' => $resource->slug]); ?>"><i class="fas fa-quote-left me-2"></i><?php echo __('Cite this Record'); ?></a></li>
      <li class="list-group-item"><a href="<?php echo url_for(['module' => 'display', 'action' => 'browse']); ?>"><i class="fas fa-th me-2"></i><?php echo __('GLAM browser'); ?></a></li>
    </ul>
  </div>
<?php end_slot(); ?>

<?php slot('title'); ?>
  <h1><?php echo esc_entities($resource->identifier); ?> - <?php echo esc_entities($resource->title); ?></h1>
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="<?php echo url_for(['module' => 'arGalleryPlugin', 'action' => 'browse']); ?>"><?php echo __('Gallery'); ?></a></li>
      <li class="breadcrumb-item active"><?php echo esc_entities($resource->title); ?></li>
    </ol>
  </nav>
<?php end_slot(); ?>

<?php slot('content'); ?>

  <!-- Object Identification -->
  <section class="card mb-4">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0"><i class="fas fa-palette me-2"></i><?php echo __('Object Identification'); ?></h5>
    </div>
    <div class="card-body">
      <div class="row mb-3">
        <div class="col-md-3 text-muted"><?php echo __('Title'); ?></div>
        <div class="col-md-9"><strong><?php echo esc_entities($resource->title); ?></strong></div>
      </div>

      <?php if ($resource->identifier): ?>
        <div class="row mb-3">
          <div class="col-md-3 text-muted"><?php echo __('Object Number'); ?></div>
          <div class="col-md-9"><?php echo esc_entities($resource->identifier); ?></div>
        </div>
      <?php endif; ?>

      <?php if (!empty(($galleryData['work_type_name'] ?? $galleryData['work_type']))): ?>
        <div class="row mb-3">
          <div class="col-md-3 text-muted"><?php echo __('Work Type'); ?></div>
          <div class="col-md-9"><span class="badge bg-secondary"><?php echo esc_entities(($galleryData['work_type_name'] ?? $galleryData['work_type'])); ?></span></div>
        </div>
      <?php endif; ?>
    </div>
  </section>

  <!-- Creation -->
  <?php if ($creatorName || !empty($galleryData['creator_display']) || !empty($galleryData['creation_date_display'])): ?>
    <section class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-user me-2"></i><?php echo __('Creation'); ?></h5>
      </div>
      <div class="card-body">
        <?php if ($creatorName || !empty($galleryData['creator_display'])): ?>
          <div class="row mb-3">
            <div class="col-md-3 text-muted"><?php echo __('Creator'); ?></div>
            <div class="col-md-9"><?php echo esc_entities($galleryData['creator_display'] ?? $creatorName); ?></div>
          </div>
        <?php endif; ?>

        <?php if (!empty($galleryData['creator_role'])): ?>
          <div class="row mb-3">
            <div class="col-md-3 text-muted"><?php echo __('Role'); ?></div>
            <div class="col-md-9"><?php echo esc_entities($galleryData['creator_role']); ?></div>
          </div>
        <?php endif; ?>

        <?php if (!empty($galleryData['creation_date_display'])): ?>
          <div class="row mb-3">
            <div class="col-md-3 text-muted"><?php echo __('Date'); ?></div>
            <div class="col-md-9"><?php echo esc_entities($galleryData['creation_date_display']); ?></div>
          </div>
        <?php endif; ?>

        <?php if (!empty($galleryData['creation_place'])): ?>
          <div class="row mb-3">
            <div class="col-md-3 text-muted"><?php echo __('Place'); ?></div>
            <div class="col-md-9"><?php echo esc_entities($galleryData['creation_place']); ?></div>
          </div>
        <?php endif; ?>
      </div>
    </section>
  <?php endif; ?>

  <!-- Physical Description -->
  <?php if (!empty($galleryData['dimensions_display']) || !empty($galleryData['materials_display'])): ?>
    <section class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-ruler me-2"></i><?php echo __('Physical Description'); ?></h5>
      </div>
      <div class="card-body">
        <?php if (!empty($galleryData['dimensions_display'])): ?>
          <div class="row mb-3">
            <div class="col-md-3 text-muted"><?php echo __('Dimensions'); ?></div>
            <div class="col-md-9"><?php echo nl2br(esc_entities($galleryData['dimensions_display'])); ?></div>
          </div>
        <?php endif; ?>

        <?php if (!empty($galleryData['materials_display'])): ?>
          <div class="row mb-3">
            <div class="col-md-3 text-muted"><?php echo __('Materials'); ?></div>
            <div class="col-md-9"><?php echo nl2br(esc_entities($galleryData['materials_display'])); ?></div>
          </div>
        <?php endif; ?>

        <?php if (!empty($galleryData['techniques'])): ?>
          <div class="row mb-3">
            <div class="col-md-3 text-muted"><?php echo __('Techniques'); ?></div>
            <div class="col-md-9"><?php echo esc_entities($galleryData['techniques']); ?></div>
          </div>
        <?php endif; ?>
      </div>
    </section>
  <?php endif; ?>

  <!-- Description -->
  <?php if ($resource->scope_and_content || !empty($galleryData['description'])): ?>
    <section class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i><?php echo __('Description'); ?></h5>
      </div>
      <div class="card-body">
        <p><?php echo nl2br(esc_entities($galleryData['description'] ?? $resource->scope_and_content)); ?></p>
      </div>
    </section>
  <?php endif; ?>

  <!-- Subject Matter -->
  <?php if (!empty($galleryData['subject_display']) || !empty($galleryData['inscriptions'])): ?>
    <section class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-tags me-2"></i><?php echo __('Subject Matter'); ?></h5>
      </div>
      <div class="card-body">
        <?php if (!empty($galleryData['subject_display'])): ?>
          <div class="row mb-3">
            <div class="col-md-3 text-muted"><?php echo __('Subject'); ?></div>
            <div class="col-md-9"><?php echo nl2br(esc_entities($galleryData['subject_display'])); ?></div>
          </div>
        <?php endif; ?>

        <?php if (!empty($galleryData['inscriptions'])): ?>
          <div class="row mb-3">
            <div class="col-md-3 text-muted"><?php echo __('Inscriptions'); ?></div>
            <div class="col-md-9"><?php echo nl2br(esc_entities($galleryData['inscriptions'])); ?></div>
          </div>
        <?php endif; ?>
      </div>
    </section>
  <?php endif; ?>

  <!-- Condition & Rights -->
  <?php if (!empty($galleryData['condition_summary']) || !empty($galleryData['rights_statement']) || !empty($galleryData['credit_line'])): ?>
    <section class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i><?php echo __('Condition & Rights'); ?></h5>
      </div>
      <div class="card-body">
        <?php if (!empty($galleryData['condition_summary'])): ?>
          <div class="row mb-3">
            <div class="col-md-3 text-muted"><?php echo __('Condition'); ?></div>
            <div class="col-md-9"><?php echo nl2br(esc_entities($galleryData['condition_summary'])); ?></div>
          </div>
        <?php endif; ?>

        <?php if (!empty($galleryData['credit_line'])): ?>
          <div class="row mb-3">
            <div class="col-md-3 text-muted"><?php echo __('Credit Line'); ?></div>
            <div class="col-md-9"><?php echo esc_entities($galleryData['credit_line']); ?></div>
          </div>
        <?php endif; ?>

        <?php if (!empty($galleryData['rights_statement'])): ?>
          <div class="row mb-3">
            <div class="col-md-3 text-muted"><?php echo __('Rights'); ?></div>
            <div class="col-md-9"><?php echo nl2br(esc_entities($galleryData['rights_statement'])); ?></div>
          </div>
        <?php endif; ?>
      </div>
    </section>
  <?php endif; ?>

  <!-- Action buttons bar -->
  <?php if ($canEdit): ?>
    <section class="actions">
      <ul class="nav nav-pills">
        <li class="nav-item">
          <a class="btn btn-success me-2" href="<?php echo url_for(['module' => 'arGalleryPlugin', 'action' => 'edit', 'slug' => $resource->slug]); ?>">
            <i class="fas fa-edit me-1"></i><?php echo __('Edit'); ?>
          </a>
        </li>
        <li class="nav-item">
          <a class="btn btn-danger me-2" href="<?php echo url_for(['module' => 'informationobject', 'action' => 'delete', 'slug' => $resource->slug]); ?>">
            <i class="fas fa-trash me-1"></i><?php echo __('Delete'); ?>
          </a>
        </li>
        <li class="nav-item">
          <a class="btn btn-primary me-2" href="<?php echo url_for(['module' => 'informationobject', 'action' => 'add', 'parent' => $resource->slug]); ?>">
            <i class="fas fa-plus me-1"></i><?php echo __('Add new'); ?>
          </a>
        </li>
        <li class="nav-item">
          <a class="btn btn-secondary me-2" href="<?php echo url_for(['module' => 'object', 'action' => 'copy', 'slug' => $resource->slug]); ?>">
            <i class="fas fa-copy me-1"></i><?php echo __('Duplicate'); ?>
          </a>
        </li>
        <li class="nav-item">
          <a class="btn btn-secondary me-2" href="<?php echo url_for(['module' => 'default', 'action' => 'move', 'slug' => $resource->slug]); ?>">
            <i class="fas fa-arrows-alt me-1"></i><?php echo __('Move'); ?>
          </a>
        </li>
        <li class="nav-item dropup">
          <a class="btn btn-secondary dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
            <?php echo __('More'); ?>
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="<?php echo url_for(['module' => 'informationobject', 'action' => 'rename', 'slug' => $resource->slug]); ?>"><i class="fas fa-i-cursor me-2"></i><?php echo __('Rename'); ?></a></li>
            <li><a class="dropdown-item" href="<?php echo url_for(['module' => 'informationobject', 'action' => 'updatePublicationStatus', 'slug' => $resource->slug]); ?>"><i class="fas fa-globe me-2"></i><?php echo __('Update publication status'); ?></a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="<?php echo url_for(['module' => 'physicalobject', 'action' => 'link', 'slug' => $resource->slug]); ?>"><i class="fas fa-box me-2"></i><?php echo __('Link physical storage'); ?></a></li>
            <li><hr class="dropdown-divider"></li>
            <?php if ($digitalObject): ?>
              <li><a class="dropdown-item" href="<?php echo url_for([$qubitResource->digitalObjectsRelatedByobjectId[0], 'module' => 'digitalobject', 'action' => 'edit']); ?>"><i class="fas fa-edit me-2"></i><?php echo __('Edit digital object'); ?></a></li>
            <?php else: ?>
              <li><a class="dropdown-item" href="<?php echo url_for([$qubitResource, 'module' => 'object', 'action' => 'addDigitalObject']); ?>"><i class="fas fa-link me-2"></i><?php echo __('Link digital object'); ?></a></li>
            <?php endif; ?>
            <li><a class="dropdown-item" href="<?php echo url_for(['module' => 'informationobject', 'action' => 'multiFileUpload', 'slug' => $resource->slug]); ?>"><i class="fas fa-upload me-2"></i><?php echo __('Import digital objects'); ?></a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="<?php echo url_for([$qubitResource, 'sf_route' => 'slug/default', 'module' => 'right', 'action' => 'edit']); ?>"><i class="fas fa-balance-scale me-2"></i><?php echo __('Create new rights'); ?></a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="<?php echo url_for(['module' => 'grap', 'action' => 'index', 'slug' => $resource->slug]); ?>"><i class="fas fa-file-invoice-dollar me-2"></i><?php echo __('View GRAP data'); ?></a></li>
            <li><a class="dropdown-item" href="<?php echo url_for(['module' => 'grap', 'action' => 'edit', 'slug' => $resource->slug]); ?>"><i class="fas fa-edit me-2"></i><?php echo __('Edit GRAP data'); ?></a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="<?php echo url_for(['module' => 'spectrum', 'action' => 'index', 'slug' => $resource->slug]); ?>"><i class="fas fa-layer-group me-2"></i><?php echo __('View Spectrum data'); ?></a></li>
            <li><a class="dropdown-item" href="<?php echo url_for(['module' => 'spectrum', 'action' => 'label', 'slug' => $resource->slug]); ?>"><i class="fas fa-barcode me-2"></i><?php echo __('Generate label'); ?></a></li>
            <li><a class="dropdown-item" href="<?php echo url_for(['module' => 'cco', 'action' => 'provenance', 'slug' => $resource->slug]); ?>"><i class="fas fa-sitemap me-2"></i><?php echo __('Provenance'); ?></a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="<?php echo url_for(['module' => 'spectrum', 'action' => 'workflow', 'slug' => $resource->slug]); ?>"><i class="fas fa-tasks me-2"></i><?php echo __('Workflow Status'); ?></a></li>
          </ul>
    </section>
  <?php endif; ?>

<?php end_slot(); ?>
